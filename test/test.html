<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Test</title>
		<link rel="stylesheet" href="../components/qunit/qunit/qunit.css">
		<script src="../components/qunit/qunit/qunit.js"></script>

		<script src="../components/jquery/dist/jquery.min.js"></script>
		<script src="../components/jquery-mockjax/jquery.mockjax.js"></script>

		<script src="../jquery.fs.pronto.js"></script>
	</head>
	<body>
		<div id="qunit"></div>
		<div id="qunit-fixture">
			<div id="pronto">
				<p>Old content</p>
				<a href="page.html">Link</a>
			</div>
		</div>
		<script>

			// Set up

			$.mockjax({
				url: "page.html",
				responseText: {
					"title": "New Page",
					"content": "<p>New content</p>"
				}
			})

			$.mockjax({
				url: "http://localhost:8888/GitHub/Pronto/test/page.html", // mamp
				responseText: {
					"title": "New Page",
					"content": "<p>New content</p>"
				}
			});

			$.pronto();

			// Tests

			QUnit.asyncTest("Request Page", function(assert) {
				expect(1);

				$(window).one("pronto.render", function() {
					var check = $("#pronto p").text().toLowerCase();
					assert.equal(check, "new content", "HTML loaded");
					QUnit.start();
				});

				$("#pronto a").trigger("click");
			});

			QUnit.asyncTest("Navigate Back", function(assert) {
				expect(1);

				$(window).one("pronto.render", function() {
					var check = $("#pronto p").text().toLowerCase();
					assert.equal(check, "old content", "HTML reverted");
					QUnit.start();
				});

				window.history.back();
			});

			QUnit.asyncTest("Events", function(assert) {
				expect(5);

				$(window).one("pronto.request", function() {
					assert.ok(true, "pronto.request Fired");
				}).one("pronto.progress", function() {
					assert.ok(true, "pronto.progress Fired");
				}).one("pronto.load", function() {
					assert.ok(true, "pronto.load Fired");
				}).one("pronto.render", function() {
					assert.ok(true, "pronto.render Fired");

					$.pronto("load", "error.html");
				}).one("pronto.error", function() {
					assert.ok(true, "pronto.error Fired");

					window.history.back();

					QUnit.start();
				});

				$.pronto("load", "page.html");
			});

			QUnit.asyncTest("'load' Method", function(assert) {
				expect(1);

				$(window).one("pronto.render", function() {
					var check = $("#pronto p").text().toLowerCase();
					assert.equal(check, "new content", "HTML loaded");
					QUnit.start();
				});

				$.pronto("load", "page.html");
			});

/*
			QUnit.test("Get", function( assert ) {
				assert.ok(true, "'foo' was set to 'bar'");
			});

			QUnit.module("Testing");

			QUnit.test("Set", function( assert ) {
				eraseCookie("foo");

				$.macaroon("foo", "bar");

				var exists = document.cookie.indexOf("foo=bar") > -1;
				assert.ok(exists, "'foo' was set to 'bar'");
			});

			QUnit.test("Get", function( assert ) {
				eraseCookie("foo");

				$.macaroon("foo", "bar");

				var value = $.macaroon("foo");
				assert.equal(value, "bar", "'foo' is equal to 'bar'");
			});

			QUnit.test("Erase", function( assert ) {
				eraseCookie("foo");

				$.macaroon("foo", "bar");

				$.macaroon("foo", null);

				var exists = document.cookie.indexOf("foo=bar") < 0;
				assert.ok(exists, "'foo' was cleared");
			});

			// Different method from: http://stackoverflow.com/questions/179355/clearing-all-cookies-with-javascript#179514
			function eraseCookie(name) {
				var pathParts = location.pathname.split('/'),
					pathCurrent = ' path=';

				document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 GMT;';

				for (var i = 0; i < pathParts.length; i++) {
					pathCurrent += ((pathCurrent.substr(-1) != '/') ? '/' : '') + pathParts[i];
					document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 GMT;' + pathCurrent + ';';
				}
			}
*/
		</script>
	</body>
</html>